<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="form_page" name="Helpdesk Form">
    <html>
    <head>
        <style>
            @import "https://unpkg.com/open-props";
            *,
            *::before,
            *::after {
            box-sizing: border-box;
            }

            h1 {
            font-weight: bold;
            font-size: 1.4em;
            text-align: center;
            margin-bottom: 20px;
            }

            button {
            font: inherit;
            }

            .page {
            color: var(--gray-9);
            background-color: var(--gray-0);
            display: grid;
            grid-template-areas: "main";
            min-height: 100vh;
            font-family: var(--font-sans);
            }
            .page__mani {
            grid-area: main;
            }

            .main {
            display: flex;
            flex-direction: column;
            justify-items: center;
            align-items: center;
            padding: var(--size-3);
            }
            .main__form {
            max-width: 30em;
            }

            .form {
            color: var(--gray-9);
            background-color: #d6e2f4;
            display: grid;
            padding: var(--size-4);
            width: 100%;
            border: 1px solid var(--gray-4);
            border-radius: var(--radius-2);
            }
            .form__linput {
            display: grid;
            margin-bottom: var(--size-3);
            }
            .form__label {
            margin-bottom: var(--size-2);
            }
            .form__input, .form__select {
            padding: 1em 0.7rem;
            border: 1px solid var(--gray-4);
            border-radius: var(--radius-2);
            }
            .form__select {
            background: inherit;
            }
            .form__textarea {
            padding: 1em 0.7rem;
            resize: vertical;
            border: 1px solid var(--gray-4);
            border-radius: var(--radius-2);
            font: inherit;
            }
            .form__btn {
            margin-right: auto;
            }

            .primary-btn {
            transition: 180ms ease-in;
            color: var(--gray-0);
            background-color: #f58c00;
            padding: 0.7em var(--size-3);
            border: 0;
            border-radius: var(--radius-2);
            cursor: pointer;
            font-size: 1.5em;
            }
            .primary-btn:hover {
            background-color: #f4bd48;
            }
        </style>
         <script src="https://www.google.com/recaptcha/api.js"></script>
         <script>
            function validateForm() {
                var response = grecaptcha.getResponse();
                if (response.length === 0) {
                    alert("Veuillez compléter le reCAPTCHA.");
                return false;
                }
                return true;
            }

            const selectProduct = document.getElementById('product-select');

            selectProduct.addEventListener('change', () => {
            const selectedProduct = selectProduct.value;

            fetch('/sinergis/get_subproduct')
                .then(response => response.json())
                .then(data => {
                    const subproducts = data.subproducts;

                subproducts.forEach(subproduct => {
                    console.log(subproduct);
                });
                })
                .catch(error => {
                console.error('Erreur lors de la requête:', error);
                });
            });
        </script>
    </head>
    <body class="page">
        <main class="main page__main">
            <p t-if="success and not error" style="background-color: #5cb85c; color: #fff; text-align: center; padding: 10px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.35) 0px 3px 12px;">Votre ticket a bien été pris en charge par Sinergis.<br/>Nous reviendrons vers vous rapidement.</p>
            <p t-if="error" style="background-color: #E94D4D; color: #fff; text-align: center; padding: 10px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.35) 0px 3px 12px;">Erreur<br/><t t-esc="error"/></p>
            <form class="form main__form" id="help_form" method="POST" onsubmit="return validateForm();">
            <h1>Formulaire d'assistance Sinergis</h1>
            <input type="hidden" name="csrf_token" t-att-value="csrf" />
            <div class="form__linput">
                <label class="form__label" for="name">Nom et prénom</label>
                <input class="form__input" type="text" id="name" name="name" placeholder="Nom et prénom.." required="True" maxlength="50"/>
            </div>
            <div class="form__linput">
                <label class="form__label" for="company">Société</label>
                <input class="form__input" type="text" id="company" name="company" placeholder="Société.." required="True" maxlength="50"/>
            </div>
            <div class="form__linput">
                <label class="form__label" for="email">E-mail</label>
                <input class="form__input" type="text" id="email" name="email" placeholder="Adresse e-mail.." required="True" maxlength="50"/>
            </div>
            <div class="form__linput">
                <label class="form__label" for="product-select">Produit</label>
                <select class="form__select" id="product-select" name="products" required="True">
                <option value="">Choisissez votre produit</option>
                <t t-foreach="products" t-as="product">
                    <option t-att-value="product.id"><t t-esc="product.name"/></option>
                </t>
                </select>
            </div>
            <div class="form__linput">
                <label class="form__label" for="subject">Sujet</label>
                <input class="form__input" type="text" id="subject" name="subject" placeholder="Sujet.." required="True" maxlength="150"/>
            </div>
            <div class="form__linput">
                <label class="form__label" for="problem">Description du problème</label>
                <textarea class="form__textarea" id="problem" name="problem" placeholder="Décrire votre problème.." rows="7" required="True" maxlength="2000"></textarea>
            </div>
            <div class="g-recaptcha" data-sitekey="6Lf5wOMmAAAAAO-ow6ARgz6ZX0guZEm3yE81O32M"></div>
            <br/>
            <input type="submit" class="primary-btn form__btn" value="Envoyer"/>
            </form>
        </main>
    </body>
    </html>
  </template>
</odoo>

