<odoo>
    <data>

        <record id="sinergis_inherited_helpdesk_ticket_tree" model="ir.ui.view">
            <field name="name">sinergis.inherited.helpdesk.ticket.tree</field>
            <field name="model">helpdesk.ticket</field>
            <field name="inherit_id" ref="helpdesk.helpdesk_tickets_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='display_name']" position="before">
                  <field name="create_date"/>
                  <field name="priority" position="move"/>
                  <field name="partner_id" position="move"/>
                  <field name="x_sinergis_helpdesk_ticket_produits" string="Produit"/>
                </xpath>
                <xpath expr="//field[@name='display_name']" position="after">
                  <field name="user_id" position="move"/>
                  <field name="x_sinergis_helpdesk_ticket_temps_cumule" widget="float_time" string="Temps passé"/>
                  <field name="x_sinergis_helpdesk_ticket_facturation"/>
                  <field name="activity_ids" position="move"/>
                  <field name="company_id" position="move"/>
                  <field name="stage_id" position="move"/>
                </xpath>

                <xpath expr="//field[@name='team_id']" position="attributes">
                  <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='sla_deadline']" position="attributes">
                  <attribute name="invisible">1</attribute>
                </xpath>
            </field>
        </record>

        <record id="sinergis_inherited_helpdesk_ticket_form" model="ir.ui.view">
            <field name="name">sinergis.inherited.helpdesk.ticket.form</field>
            <field name="model">helpdesk.ticket</field>
            <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_form"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='team_id']" position="before">
                    <field name="create_date"/>
                </xpath>

                <xpath expr="//field[@name='priority']" position="after">
                    <field name="x_sinergis_helpdesk_ticket_produits"/>
                    <field name="x_sinergis_helpdesk_ticket_produits_cegid" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_produits',  '!=', 'CEGID')],'required': [('x_sinergis_helpdesk_ticket_produits',  '=', 'CEGID')]}"/>
                    <field name="x_sinergis_helpdesk_ticket_produits_sage100" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_produits',  '!=', 'SAGE 100')],'required': [('x_sinergis_helpdesk_ticket_produits',  '=', 'SAGE 100')]}"/>
                    <field name="x_sinergis_helpdesk_ticket_produits_sage1000" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_produits',  '!=', 'SAGE 1000')],'required': [('x_sinergis_helpdesk_ticket_produits',  '=', 'SAGE 1000')]}"/>
                    <field name="x_sinergis_helpdesk_ticket_produits_sap" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_produits',  '!=', 'SAP')],'required': [('x_sinergis_helpdesk_ticket_produits',  '=', 'SAP')]}"/>
                    <field name="x_sinergis_helpdesk_ticket_produits_x3" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_produits',  '!=', 'X3')],'required': [('x_sinergis_helpdesk_ticket_produits',  '=', 'X3')]}"/>
                    <field name="x_sinergis_helpdesk_ticket_produits_divers" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_produits',  '!=', 'DIVERS')],'required': [('x_sinergis_helpdesk_ticket_produits',  '=', 'DIVERS')]}"/>
                    <field name="x_sinergis_helpdesk_ticket_type_client" readonly="True" force_save="1"/>
                </xpath>

                <field name="company_id" position="replace">
                    <field name="company_id" string="Société SINERGIS"/>
                </field>

                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>

                <xpath expr="//field[@name='partner_phone']" position="after">
                    <br/>
                    <field name="x_sinergis_helpdesk_ticket_contact" domain="[('parent_id','=',partner_id)]" attrs="{'readonly': ['|',('partner_id',  '=', False),('x_sinergis_helpdesk_ticket_is_facturee','=',True)]}" options="{'no_create': True, 'no_create_edit':True}" required="True"/>
                    <field name="x_sinergis_helpdesk_ticket_contact_fixe" attrs="{'invisible': ['|',('x_sinergis_helpdesk_ticket_contact',  '=', False), ('x_sinergis_helpdesk_ticket_contact_fixe',  '=', False)]}" force_save="1" widget="phone"/>
                    <field name="x_sinergis_helpdesk_ticket_contact_mobile" attrs="{'invisible': ['|',('x_sinergis_helpdesk_ticket_contact',  '=', False), ('x_sinergis_helpdesk_ticket_contact_mobile',  '=', False)]}" force_save="1" widget="phone"/>
                    <field name="x_sinergis_helpdesk_ticket_contact_mail" attrs="{'invisible': ['|',('x_sinergis_helpdesk_ticket_contact',  '=', False), ('x_sinergis_helpdesk_ticket_contact_mail',  '=', False)]}" force_save="1"/>
                </xpath>

                <!-- CREATION DU NOTEBOOK EN BAS DE PAGE -->

                <xpath expr="//field[@name='description']" position="replace"/>
                <xpath expr="//form/sheet/group[1]" position="after">
                    <group>
                        <field name="description" class="field_description" placeholder="Description du problème..." string="Description du problème" required="True"/>
                    </group>
                        <br/>
                        <br/>
                        <button name="x_sinergis_helpdesk_ticket_show_facturation_button" string="Afficher la partie traitement" type="object" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_show_facturation',  '=', True)]}"/>
                    <button name="x_sinergis_helpdesk_ticket_show_facturation_button" string="Masquer la partie traitement" type="object" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_show_facturation',  '=', False)]}"/>
                        <br/>
                        <br/>
                    <field name="x_sinergis_helpdesk_ticket_show_facturation" invisible="1"/>
                    <div attrs="{'invisible': [('x_sinergis_helpdesk_ticket_show_facturation',  '=', False)]}">
                    <group>
                        <field name="x_sinergis_helpdesk_ticket_ticket_resolution" class="field_description" placeholder="Description de la résolution du ticket..." string="Description de l'intervention"/>
                    <field name="x_sinergis_helpdesk_ticket_facturation" attrs="{'readonly': [('x_sinergis_helpdesk_ticket_is_facturee','=',True)]}"/>
                    <field name="x_sinergis_helpdesk_ticket_project" domain="[('partner_id','=',partner_id)]" attrs="{'readonly': ['|',('partner_id',  '=', False),('x_sinergis_helpdesk_ticket_is_facturee','=',True)], 'invisible': ['|','|','|',('x_sinergis_helpdesk_ticket_facturation',  '=', False),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Temps passé'),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Contrat heures'),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Non facturable')]}" options="{'no_create': True, 'no_create_edit':True}"/>
                    <field name="x_sinergis_helpdesk_ticket_tache" domain="[('project_id','=',x_sinergis_helpdesk_ticket_project),('name','not ilike','HEURES')]" attrs="{'readonly': [('x_sinergis_helpdesk_ticket_is_facturee','=',True)], 'invisible' : ['|','|',('x_sinergis_helpdesk_ticket_project',  '=', False),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Contrat heures'),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Non facturable')]}" options="{'no_create': True, 'no_create_edit':True}"/>
                    <field name="x_sinergis_helpdesk_ticket_tache2" domain="[('partner_id','=',partner_id),('name','ilike','HEURES')]" options="{'no_create': True, 'no_create_edit':True}" attrs="{'readonly': ['|',('partner_id',  '=', False),('x_sinergis_helpdesk_ticket_is_facturee','=',True)],'invisible' : [('x_sinergis_helpdesk_ticket_facturation',  '!=', 'Contrat heures')]}"/>
                    <field name="x_sinergis_helpdesk_ticket_tache_information" force_save="1" attrs="{'invisible' : [('x_sinergis_helpdesk_ticket_tache_information',  '=', False)]}" readonly="True" string=""/>
                </group>
                <br/>
                <field name="x_sinergis_helpdesk_ticket_taches" attrs="{'invisible': ['|',('partner_id',  '=', False),'&amp;',('x_sinergis_helpdesk_ticket_facturation',  '!=', 'Devis'),('x_sinergis_helpdesk_ticket_facturation',  '!=', 'Contrat heures')]}" string="Prestations en cours">
                    <tree decoration-warning="effective_hours>0.9*planned_hours" decoration-danger="effective_hours>=planned_hours" >
                        <field name="project_id"/>
                        <field name="name"/>
                        <field name="user_ids" domain="[('share','=',False),('active','=',True)]" widget="many2many_avatar_user"/>
                        <field name="planned_hours" string="Heures prévues" widget="float_time"/>
                        <field name="effective_hours" widget="float_time"/>
                        <field name="remaining_hours" widget="float_time"/>
                        <field name="progress" widget="progressbar"/>
                        <field name="company_id"/>
                    </tree>
                </field>
                <group>
                <field name="x_sinergis_helpdesk_ticket_temps_passe" widget="float_time" style="font-size:13pt;"/>
                <field name="x_sinergis_helpdesk_ticket_is_solved"/>
                <field name="x_sinergis_helpdesk_ticket_intervention_count"/>
                <field name="x_sinergis_helpdesk_ticket_temps_cumule" widget="float_time"/>
                </group>
                <field name="x_sinergis_helpdesk_ticket_is_facturee" invisible="True"/>
                <group>
                <button name="x_sinergis_helpdesk_ticket_duree_button" string="Décompter le temps facturé" type="object" class="btn-primary oe_right" readonly="True" confirm="Êtes-vous sûr de vouloir décompter les heures ?" attrs="{'invisible': ['|','|','|','|',('x_sinergis_helpdesk_ticket_facturation',  '=', False),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Temps passé'),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Non facturable'),('x_sinergis_helpdesk_ticket_is_facturee', '=', True),'&amp;',('x_sinergis_helpdesk_ticket_tache', '=', False),('x_sinergis_helpdesk_ticket_tache2', '=', False)]}" style="background-color:green;"/>
                </group>
                <group>
                <button name="x_sinergis_helpdesk_ticket_duree_button" string="Temps facturé décompté" type="object" class="btn-primary oe_right" readonly="True" confirm="Vous avez déjà décompté du temps sur cet évenement. Souhaitez vous vraiment encore ?" attrs="{'invisible': ['|','|','|','|',('x_sinergis_helpdesk_ticket_facturation',  '=', False),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Temps passé'),('x_sinergis_helpdesk_ticket_facturation',  '=', 'Non facturable'),('x_sinergis_helpdesk_ticket_is_facturee', '=', False),'&amp;',('x_sinergis_helpdesk_ticket_tache', '=', False),('x_sinergis_helpdesk_ticket_tache2', '=', False)]}" style="background-color:orange;"/>
                </group>
                <group>
                  <button name="x_sinergis_helpdesk_ticket_reset_button" string="Réinitialiser" type="object" class="btn-primary" readonly="True" confirm="Souhaitez-vous vraiment réinitialiser les heures décomptées ?" attrs="{'invisible': [('x_sinergis_helpdesk_ticket_is_facturee', '=', False)]}" style="background-color:grey;"/>
                </group>
                    </div>
                </xpath>

                <!-- RENDRE INVISIBLE LES ELEMENTS INUTILES -->
                <xpath expr="//field[@name='team_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='ticket_type_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='tag_ids']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='partner_email']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <!-- MODIFICATION ELEMENTS PRESENTS -->

                <field name="partner_id" position="attributes">
                    <attribute name="attrs">{'readonly': [('x_sinergis_helpdesk_ticket_is_facturee','=',True)]}</attribute>
                    <attribute name="domain">[('is_company','=',True)]</attribute>
                    <attribute name="options">{'no_create': True, 'no_create_edit':True}</attribute>
                    <attribute name="string">Société</attribute>
                </field>
                <field name="partner_phone" position="attributes">
                    <attribute name="readonly">True</attribute>
                    <attribute name="string">Téléphone société</attribute>
                </field>
                <field name="partner_name" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>

            </field>
        </record>

    </data>
</odoo>
