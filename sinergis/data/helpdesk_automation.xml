<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="sinergis_helpdesk_ticket_answer_closed_ticket_automation" model="base.automation">
        <field name="name">Ouvrir les tickets fermé avec relance client</field>
        <field name="model_id" ref="mail.model_mail_message"/>
        <field name="state">code</field>
        <field name="filter_domain">["&amp;",("message_type","=","email"),("model","=","helpdesk.ticket")]</field>
        <field name="code">
if record.res_id:
  existing_ticket = env['helpdesk.ticket'].search([('id','=',record.res_id)]) # Sélection du ticket
  if existing_ticket.stage_id.id == 3 or existing_ticket.stage_id.id == 4: # Si ticket résolu ou annulé
    record = env['helpdesk.ticket'].create({
            'name': 'RE-OUVERT : ' + existing_ticket.name.replace("RE-OUVERT : ",""),
            'partner_id': existing_ticket.partner_id.id,
            'message_ids': [record.id],
            'description': record.body,
            'partner_email': existing_ticket.partner_email,
            'team_id': env['helpdesk.ticket']._default_team_id(),
        })
    record.write({'x_sinergis_helpdesk_ticket_contact': existing_ticket.x_sinergis_helpdesk_ticket_contact.id,})
        </field>
        <field name="trigger">on_create</field>
        <field name="active" eval="True"/>
    </record>

        <record id="automated_close_old_tickets" model="base.automation">
            <field name="name">Fermer les tickets de plus de 3 mois</field>
            <field name="model_id" ref="helpdesk.model_helpdesk_ticket"/>
            <field name="state">code</field>
            <field name="code">
                <![CDATA[
                stage_id = self.env['helpdesk.stage'].search([('name','=',"Annulé")])
                tickets = env['your_module.ticket'].search([('sort_date', '<=', (fields.Date.today() - relativedelta(months=3)))])
                for ticket in tickets:
                    ticket.stage_id = stage_id
                ]]>
            </field>
            <field name="trigger">time</field>
            <field name="interval_type">days</field>
            <field name="interval_number">1</field>
            <field name="active">True</field>
        </record>

</odoo>